<!DOCTYPE HTML>
<html>
    <body>
        <style>
            canvas {
                background-color: white;
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                -ms-transform: translate(-50%,-50%);
                transform: translate(-50%,-50%);
            }
            body {
                background-color: rgb(50,50,50);
                margin: 0;
            }
        </style>
        <canvas id="canvas"></canvas>
        <script>
            var title = "Color Blind";
            var dimensions = {width:1000,height:1000};
            var images = ["images/words.png"];
            var audios = [];

            var canvas,ctx;

            function initialize() {
                document.title = title;

                canvas = document.getElementById("canvas");
                var ratio = dimensions.width/dimensions.height;
                var sizeText = "min(100vw,100vh)";
                if(ratio>1) {
                    sizeText = `min(${100/ratio}vw,100vh)`;
                    canvas.style.width = `calc(${sizeText} * ${ratio})`;
                    canvas.style.height = sizeText;
                } else if(ratio<1) {
                    sizeText = `min(100vw,${100*ratio}vh)`;
                    canvas.style.width = sizeText;
                    canvas.style.height = `calc(${sizeText} * ${1/ratio})`;
                } else {
                    canvas.style.width = sizeText;
                    canvas.style.height = sizeText;
                }
                canvas.width = dimensions.width;
                canvas.height = dimensions.height;

                ctx = canvas.getContext("2d");
                canvas.onmousemove = function(event) {
                    var rect = canvas.getBoundingClientRect();
                    Mouse.x = (event.pageX-rect.x)*canvas.width/rect.width;
                    Mouse.y = (event.pageY-rect.y)*canvas.height/rect.height;
                }
                canvas.ontouchmove = function(event) {
                    var rect = canvas.getBoundingClientRect();
                    Mouse.x = (event.touches[0].pageX-rect.x)*canvas.width/rect.width;
                    Mouse.y = (event.touches[0].pageY-rect.y)*canvas.height/rect.height;
                }
                canvas.onclick = function(event) {
                    Mouse.click = true;
                }
                canvas.onmousedown = function(event) {
                    Mouse.down = true;
                }
                canvas.ontouchstart = function(event) {
                    Mouse.down = true;
                    var rect = canvas.getBoundingClientRect();
                    Mouse.x = (event.touches[0].pageX-rect.x)*canvas.width/rect.width;
                    Mouse.y = (event.touches[0].pageY-rect.y)*canvas.height/rect.height;
                }
                canvas.ontouchend = function(event) {
                    Mouse.down = false;
                }
                canvas.onmouseup = function(event) {
                    Mouse.down = false;
                }
                canvas.onwheel = function(event) {
                    Mouse.scrollX = event.deltaX;
                    Mouse.scrollY = event.deltaY;
                    event.preventDefault();
                }
                window.onkeydown = function(event) {
                    Keys.keys[event.keyCode] = true;
                    Keys.down[event.keyCode] = true;
                }
                window.onkeyup = function(event) {
                    Keys.keys[event.keyCode] = false;
                    Keys.up[event.keyCode] = true;
                }

                Loading.loadLogoImage();
                Loading.loadImages();
                Loading.loadAudios();

                for(var key of Object.keys(Physics)) {
                    this[key] = Physics[key];
                }

                ctx.roundRect=(x,y,w,h,r)=>{
                    ctx.beginPath();
                    ctx.moveTo(x+r,y);
                    ctx.lineTo(x+w-r,y);
                    ctx.arc(x+w-r,y+r,r,1.5*Math.PI,2*Math.PI);
                    ctx.lineTo(x+w,y+h-r);
                    ctx.arc(x+w-r,y+h-r,r,0*Math.PI,0.5*Math.PI);
                    ctx.lineTo(x+r,y+h);
                    ctx.arc(x+r,y+h-r,r,0.5*Math.PI,Math.PI);
                    ctx.lineTo(x,y+r);
                    ctx.arc(x+r,y+r,r,Math.PI,1.5*Math.PI);
                }
            }
            var Loading = {
                animation: 0,
                loads: 0,
                loaded: false,
                intro: 1,
                logoImage: false,
                percent: 0,
                loadImages: function() {
                    for(var n in images) {
                        var image = document.createElement("img");
                        image.src = images[n];
                        image.onload = function() {
                            Loading.loads++;
                        }
                        images[n] = image;
                    }
                },
                loadAudios: function() {
                    for(var n in audios) {
                        var audio = document.createElement("audio");
                        audio.src = audios[n];
                        audio.oncanplaythrough = function() {
                            Loading.loads++;
                        }
                        audios[n] = audio;
                    }
                },
                loadLogoImage: function() {
                    this.logoImage = document.createElement("img");
                    this.logoImage.src = "https://johnbutlergames.w3spaces.com/logoLarge.png";
                    this.logoImage.onload = function() {
                        Loading.loads++;
                    }
                },
                updateLoadingScreen: function() {
                    var s = Math.min(dimensions.width,dimensions.height)/500;
                    var percent = this.loads/(images.length+audios.length+1);
                    this.percent = this.percent*0.9+percent*0.1;
                    ctx.save();
                    ctx.translate(dimensions.width/2,dimensions.height/2);
                    ctx.scale(s,s);
                    ctx.translate(-250,-250);
                    if(percent==1) {
                        var a = 1-this.percent*(images.length+audios.length+1)+this.loads-1;
                        ctx.globalAlpha = a;
                    }
                    ctx.fillStyle = "black";
                    ctx.fillRect(45,270,410,15);
                    ctx.fillStyle = "blue";
                    ctx.fillRect(47.5,272.5,405*this.percent,10);
                    ctx.beginPath();
                    ctx.rect(47.5,272.5,405*this.percent,10);
                    ctx.save();
                    ctx.clip();
                    ctx.fillStyle = "rgb(255,100,0)";
                    var a = this.animation/2%40;
                    for(var n=0;n<40;n++) {
                        ctx.beginPath();
                        ctx.moveTo(n*20+a+5,272.5);
                        ctx.lineTo(n*20+a+12.5,272.5);
                        ctx.lineTo(n*20+a+7.5,282.5);
                        ctx.lineTo(n*20+a,282.5);
                        ctx.closePath();
                        ctx.fill();
                    }
                    ctx.restore();
                    ctx.fillStyle = "black";
                    ctx.textAlign = "center";
                    ctx.font = "30px Arial";
                    ctx.fillText("Loading...",250,250);
                    ctx.restore();

                    this.animation++;
                    if(percent==1&&this.percent>0.99) this.loaded = true;
                },
                updateIntro: function() {
                    var s = Math.min(dimensions.width,dimensions.height)/500;
                    var i = Math.min(Physics.easeInOut(this.intro/100),Physics.easeInOut((250-this.intro)/100));
                    var i2 = Math.min(Physics.easeInOut(this.intro/50),Physics.easeInOut((250-this.intro)/50));
                    ctx.save();
                    ctx.translate(dimensions.width/2,dimensions.height/2);
                    ctx.scale(s*i2,s*i2);
                    ctx.translate(-250,-250);
                    ctx.globalAlpha = i;
                    ctx.drawImage(this.logoImage,0,0,500,500);
                    ctx.restore();

                    this.intro++;
                    if(this.intro==300) this.intro = 0;
                }
            }
            var Mouse = {
                x: 0,
                y: 0,
                down: false,
                click: false,
                scrollX: 0,
                scrollY: 0,
                inBox: function(x,y,w,h){return this.x>x&&this.x<x+w&&this.y>y&&this.y<y+h},
                clickInBox: function(x,y,w,h){return this.inBox(x,y,w,h)&&this.click}
            }
            var Keys = {
                keys: [],
                down: [],
                up: []
            }
            var Physics = {
                dirTo: (x1,y1,x2,y2)=>90+(Math.atan2(y2-y1,x2-x1)*180/Math.PI),
                distToMove: (distance,direction)=>({x:distance*Math.sin(direction*Math.PI/180),y:-distance*Math.cos(direction*Math.PI/180)}),
                distTo: (x1,y1,x2,y2)=>Math.sqrt((x2-x1)**2+(y2-y1)**2),
                rotate:(cx,cy,x,y,a)=>([a=Math.PI/180*a,{x:(Math.cos(a)*(x-cx))+(Math.sin(a)*(y-cy))+cx,y:(Math.cos(a)*(y-cy))-(Math.sin(a)*(x-cx))+cy}][1]),
                easeInOut:a=>1/(1+2.71828**(-10*(a-0.5))),
                blocksColliding:(b1,b2)=>r(b1.x+b1.w)>r(b2.x)&&r(b1.x)<r(b2.x+b2.w)&&r(b1.y+b1.h)>r(b2.y)&&r(b1.y)<r(b2.y+b2.h),
                blocksCollidingEdge:(b1,b2)=>r(b1.x+b1.w)>=r(b2.x)&&r(b1.x)<=r(b2.x+b2.w)&&r(b1.y+b1.h)>=r(b2.y)&&r(b1.y)<=r(b2.y+b2.h),
                r:n=>Math.round(n*10000)/10000
            }
            function updateBlocks(blocks,data={}) {
                data.gravity = data.gravity||{x:0,y:0};
                data.damping = data.damping||{x:1,y:1};
                data.maxCollisions = data.maxCollisions||100;

                function initBlock(block) {
                    if(!block.initialized) {
                        block.density = block.density||1;
                        block.mass = block.mass||block.w*block.h*block.density;
                        block.bounce = {x:1,y:1};
                        block.move = block.move||{x:0,y:0};
                        block.static = block.static||false;
                        block.resting = block.resting||{x:0,y:0};
                        block.last = block.last||{x:0,y:0}
                        block.initialized = true;
                    }

                    block.collided = false;
                    if(!block.static) {
                        if(!block.resting.x) {
                            block.move.x *= data.damping.x;
                            block.move.x += data.gravity.x;
                        }
                        if(!block.resting.y) {
                            block.move.y *= data.damping.y;
                            block.move.y += data.gravity.y;
                        }
                    }

                    block.resting.x = false;
                    block.resting.y = false;
                    block.last.x = block.x;
                    block.last.y = block.y;
                }

                function initialize() {
                    for(var n in blocks) {
                        blocks[n].id = n;
                    }
                    for(var block of blocks) {
                        initBlock(block);
                    }
                }

                function resolveCollision(b1,b2,a) {
                    if((b1.static||b1.resting[a])&&(b2.static||b2.resting[a])) return false;
                    if(!(b2.static||b2.resting[a])&&(b1.static||b1.resting[a])) return resolveCollision(b2,b1,a);

                    b1.collided = true;
                    b2.collided = true;
                    //blocks have collided

                    var c1 = {x:b1.last.x+b1.w/2,y:b1.last.y+b1.h/2};
                    var c2 = {x:b2.last.x+b2.w/2,y:b2.last.y+b2.h/2};
                    //find centers

                    var c = a;
                    var dim = a=='x'?'w':'h';

                    if(b2.static||b2.resting[a]) {
                        //static-dynamic collision
                        if(c1[a]>c2[a]) {
                            b1[a] = b2[a]+b2[dim];
                        } else {
                            b1[a] = b2[a]-b1[dim];
                        }
                        var avg = (b1.move[a]+b2.move[a])/2;
                        b1.move[a] = avg;
                        b1.resting[a] = true;
                    } else {
                        //dynamic-dynamic collision
                        if(c1[a]>c2[a]) {
                            var dist = b2[a]+b2[dim]-b1[a];
                            b1[a] += dist/2;
                            b2[a] -= dist/2;
                        } else {
                            var dist = b2[a]-b1[a]-b1[dim];
                            b1[a] += dist/2;
                            b2[a] -= dist/2;
                        }
                        var avg = (b1.move[a]+b2.move[a])/2;
                        b1.move[a] = avg;
                        b2.move[a] = avg;
                    }
                    return true;
                }

                function updateStaticAxis(a) {
                    for(var block of blocks) {
                        if(!block.static) continue;
                        block[a] += block.move[a];
                    }
                }

                function updateAxis(a) {
                    for(var block of blocks) {
                        if(block.static) continue;
                        block[a] += block.move[a];
                    }
                    var n3 = 0;
                    while(n3<data.maxCollisions) {
                        var collisions = false;
                        for(var n=0;n<blocks.length;n++) {
                            var block = blocks[n];
                            for(var n2=n+1;n2<blocks.length;n2++) {
                                var block2 = blocks[n2];
                                if(blocksColliding(block,block2)) {
                                    var x = resolveCollision(block2,block,a);
                                    var y = resolveCollision(block,block2,a);
                                    collisions = collisions||x||y;
                                }
                            }
                        }
                        if(!collisions) break;
                        n3++;
                    }
                }

                initialize();
                updateStaticAxis("x");
                updateAxis("x");
                updateStaticAxis("y");
                updateAxis("y");
            }
            function f(s) {
                ctx.font = s+"px Arial";
            }
            function update() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                if(Loading.loaded) {
                    if(Loading.intro) {
                        Loading.updateIntro();
                    } else {
                        main();
                    }
                } else {
                    Loading.updateLoadingScreen();
                }
                Mouse.click = false;
                Mouse.right = false;
                Mouse.scrollX = 0;
                Mouse.scrollY = 0;
                Keys.down = [];
                Keys.up = [];
            }

            initialize();
            window.setInterval(update,10);

            function main() {
                ctx.drawImage(images[0],0,0,1000,1000);
                game.tick();
                t++;
            }

            var game = {
                tick: function() {
                    if(this.page=="menu") {
                        this.menu();
                    } else if(this.page=="tutorial") {
                        this.tutorial.update();
                    } else if(this.page=="game") {
                        this.update();
                        this.draw();
                    }
                },
                menu: function() {
                    f(160);
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    var text = "Color Blind";
                    var width = ctx.measureText(text).width;
                    var currentWidth = 0;
                    var charWidth = 50;
                    for(var n=0;n<text.length;n++) {
                        var charWidth = ctx.measureText(text[n]).width;
                        ctx.save();
                        ctx.translate(500-width/2+currentWidth+charWidth/2,200);
                        var a = 1+Math.max(0,Math.sin(t/40-n/4)-0.8)/1.5;
                        ctx.scale(a,a);
                        ctx.fillStyle = `hsl(${n*60},100%,${(a-1)*400}%)`;
                        ctx.fillText(text[n],0,0);
                        ctx.restore();
                        currentWidth += charWidth;
                    }
                    //animated title

                    ctx.fillStyle = "black";
                    f(70);
                    ctx.fillText("Highscore: "+highscore,500,700);
                    ctx.fillText("By John Butler",500,920);
                    //credits and highscore

                    f(120);
                    ctx.fillStyle = "rgb(120,200,255)";
                    if(Mouse.inBox(300,410,400,200)) {
                        if(Mouse.click) {
                            if(tutorial) {
                                this.page = "tutorial";
                                tutorial = false;
                            } else {
                                this.page = "game";
                                game.reset();
                            }
                        }
                    }
                    ctx.roundRect(300,410,400,200,50);
                    ctx.fill();
                    ctx.fillStyle = "black";
                    ctx.fillText("Play",500,510);
                    //play button
                },
                tutorial: {
                    page: 1,
                    update: function() {
                        ctx.fillStyle = "black";
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        f(100);
                        ctx.fillText("Tutorial",500,100);

                        if(this.page==1) {
                            f(50);
                            ctx.fillText("Would you like a tutorial?",500,400);
                            f(40);
                            ctx.fillText("Recommended for",350,750);
                            ctx.fillText("first time players.",350,800);
                            ctx.lineJoin = "round";
                            ctx.lineCap = "round";
                            ctx.strokeStyle = "black";
                            ctx.lineWidth = 5;
                            ctx.beginPath();
                            ctx.moveTo(350,620);
                            ctx.lineTo(350,700);
                            ctx.moveTo(350,620);
                            ctx.lineTo(370,650);
                            ctx.moveTo(350,620);
                            ctx.lineTo(330,650);
                            ctx.stroke();

                            f(50);
                            ctx.fillStyle = "rgb(120,200,255)";
                            if(Mouse.inBox(250,470,200,120)) {
                                if(Mouse.click) {
                                    this.page = 2;
                                }
                            }
                            ctx.roundRect(250,470,200,120,50);
                            ctx.fill();
                            ctx.fillStyle = "black";
                            ctx.fillText("Yes",350,530);
                            //yes button

                            ctx.fillStyle = "rgb(120,200,255)";
                            if(Mouse.inBox(550,470,200,120)) {
                                if(Mouse.click) {
                                    game.page = "game";
                                    game.reset();
                                }
                            }
                            ctx.roundRect(550,470,200,120,50);
                            ctx.fill();
                            ctx.fillStyle = "black";
                            ctx.fillText("No",650,530);
                            //no button
                        } else if(this.page==2) {
                            var data = {
                                title: "Click the button colored",
                                buttons: [
                                    {color:"red",text:""},
                                    {color:"green",text:""},
                                    {color:"blue",text:""},
                                    {color:"purple",text:""},
                                    {color:"orange",text:""},
                                    {color:"yellow",text:""}
                                ],
                                correct: 2,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Blue"}
                            }
                            game.buttons(data);
                        } else if(this.page==3) {
                            var data = {
                                title: "Click the button colored",
                                buttons: [
                                    {color:"orange",text:""},
                                    {color:"red",text:""},
                                    {color:"green",text:""},
                                    {color:"yellow",text:""},
                                    {color:"purple",text:""},
                                    {color:"blue",text:""},
                                ],
                                correct: 3,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Yellow"}
                            }
                            game.buttons(data);
                        } else if(this.page==4) {
                            var data = {
                                title: "Click the color of this button:",
                                buttons: [
                                    {text:"Orange"},
                                    {text:"Purple"},
                                    {text:"Black"},
                                    {text:"Cyan"},
                                    {text:"Red"},
                                    {text:"Green"},
                                ],
                                correct: 5,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"",color:"green"}
                            }
                            game.buttons(data);
                        } else if(this.page==5) {
                            var data = {
                                title: "Click the color of this button:",
                                buttons: [
                                    {text:"Red"},
                                    {text:"Black"},
                                    {text:"Orange"},
                                    {text:"Green"},
                                    {text:"Purple"},
                                    {text:"Blue"},
                                ],
                                correct: 4,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"",color:"purple"}
                            }
                            game.buttons(data);
                        } else if(this.page==6) {
                            var data = {
                                title: "Click the button colored",
                                buttons: [
                                    {text:"Black",color:"red"},
                                    {text:"Cyan",color:"orange"},
                                    {text:"Purple",color:"green"},
                                    {text:"Blue",color:"yellow"},
                                    {text:"Red",color:"blue"},
                                    {text:"Green",color:"purple"},
                                ],
                                correct: 1,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Orange",color:"green"}
                            }
                            game.buttons(data);
                        } else if(this.page==7) {
                            var data = {
                                title: "Click the button colored",
                                buttons: [
                                    {text:"Cyan",color:"red"},
                                    {text:"Green",color:"orange"},
                                    {text:"Orange",color:"purple"},
                                    {text:"Red",color:"yellow"},
                                    {text:"Blue",color:"blue"},
                                    {text:"Yellow",color:"black"},
                                ],
                                correct: 2,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Purple",color:"orange"}
                            }
                            game.buttons(data);
                        } else if(this.page==8) {
                            var data = {
                                title: "Click the color of this button:",
                                buttons: [
                                    {text:"Red",color:"pink"},
                                    {text:"Orange",color:"black"},
                                    {text:"Cyan",color:"blue"},
                                    {text:"Blue",color:"red"},
                                    {text:"Black",color:"orange"},
                                    {text:"Pink",color:"yellow"},
                                ],
                                correct: 0,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.tutorial.page++;
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Green",color:"red"}
                            }
                            game.buttons(data);
                        } else if(this.page==9) {
                            var data = {
                                title: "Click the color of this button:",
                                buttons: [
                                    {text:"Black",color:"orange"},
                                    {text:"Cyan",color:"blue"},
                                    {text:"Yellow",color:"yellow"},
                                    {text:"Orange",color:"pink"},
                                    {text:"Blue",color:"red"},
                                    {text:"Pink",color:"cyan"},
                                ],
                                correct: 5,
                                correctScript: function() {},
                                failScript: function() {},
                                endCorrect: function() {
                                    game.page = "game";
                                    game.reset();
                                    game.buttonClicks = [0,0,0,0,0,0];
                                },
                                endFail: function() {},
                                promptButton: {text:"Black",color:"pink"}
                            }
                            game.buttons(data);
                        }
                    }
                },
                draw: function() {
                    ctx.fillStyle = "lime";
                    if(this.time/this.maxTime<0.5) ctx.fillStyle = "yellow";
                    if(this.time/this.maxTime<0.2) ctx.fillStyle = "red";
                    ctx.fillRect(0,0,1000*this.time/this.maxTime,50);
                    //time bar

                    ctx.fillStyle = "black";
                    ctx.textAlign = "left";
                    ctx.textBaseline = "middle";
                    f(40);
                    ctx.fillText("Score: "+this.score,20,90);
                    //score text

                    this.buttons(this.data,this.countDown==0&&this.gameOver==false);
                    //buttons

                    if(this.countDown>0) {
                        ctx.fillStyle = "rgba(255,255,255,0.7)";
                        ctx.strokeStyle = "rgba(0,0,0,0.7)";
                        ctx.lineWidth = 5;
                        ctx.roundRect(350,400,300,200,30);
                        ctx.fill();
                        ctx.stroke();
                        f(120);
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillStyle = "black";
                        var text = ["Go!",1,2,3][Math.floor(this.countDown/100)];
                        ctx.fillText(text,500,510);
                    }
                    //countdown

                    if(this.gameOver) this.gameOverMenu();
                },
                update: function() {
                    if(this.countDown>0) {
                        this.countDown--;
                        return;
                    }
                    if(this.gameOver) {
                        this.gameOverAnimation++;
                    } else {
                        if(!this.correct) this.time--;
                        if(this.time==0) {
                            this.gameOver = true;
                            updateHighscore();
                        }
                    }
                },
                gameOverMenu: function() {
                    ctx.save();
                    ctx.translate(0,Math.min(-1000+easeInOut(this.gameOverAnimation/100)*1000,0));
                    //slide in animation
                    
                    ctx.fillStyle = "white";
                    ctx.strokeStyle = "black";
                    ctx.lineWidth = 5;
                    ctx.roundRect(150,150,700,700,30);
                    ctx.fill();
                    ctx.stroke();
                    //background

                    ctx.fillStyle = "black";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    f(100);
                    ctx.fillText("Game Over!",500,250);
                    //title

                    f(70);
                    ctx.fillText("Score: "+this.score,500,420);
                    //score
                    
                    f(70);
                    ctx.fillText("Highscore: "+highscore,500,520);
                    //highscore

                    f(70);
                    ctx.fillStyle = "rgb(120,200,255)";
                    if(Mouse.inBox(180,650,300,160)&&this.gameOverAnimation>100) {
                        if(Mouse.click) {
                            this.reset();
                        }
                    }
                    ctx.roundRect(180,650,300,160,50);
                    ctx.fill();
                    ctx.fillStyle = "black";
                    ctx.fillText("Retry",330,730);
                    //retry button
                    
                    f(70);
                    ctx.fillStyle = "rgb(120,200,255)";
                    if(Mouse.inBox(520,650,300,160)&&this.gameOverAnimation>100) {
                        if(Mouse.click) {
                            this.page = "menu";
                        }
                    }
                    ctx.roundRect(520,650,300,160,50);
                    ctx.fill();
                    ctx.fillStyle = "black";
                    ctx.fillText("Quit",670,730);
                    //quit button
                    
                    ctx.restore();
                },
                buttons: function(data,click) {
                    if(click===undefined) click = true;
                    ctx.fillStyle = "black";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    f(50);
                    ctx.fillText(data.title,500,200);

                    if(!data.promptButton.textColor) {
                        data.promptButton.textColor = "black";
                        var c = data.promptButton.color;
                        if(c=="black"||c=="blue"||c=="purple"||c=="green") data.promptButton.textColor = "white";
                    }
                    if(!data.promptButton.color) data.promptButton.color = "white";
                    ctx.save();
                    ctx.translate(500,320);
                    this.drawButton(data.promptButton);
                    ctx.restore();
                    for(var n=0;n<data.buttons.length;n++) {
                        var button = data.buttons[n];
                        if(!button.textColor) {
                            button.textColor = "black";
                            var c = button.color;
                            if(c=="black"||c=="blue"||c=="purple"||c=="green") button.textColor = "white";
                        }
                        if(!button.color) button.color = "white";
                        ctx.save();
                        ctx.translate(350+Math.floor(n/3)*300,500+n%3*170);
                        if(this.buttonClicks[n]>0) {
                            if(this.buttonClicks[n]>1) {
                                this.buttonClicks[n]--;
                            } else {
                                if(data.correct==n) {
                                    data.endCorrect();
                                } else {
                                    data.endFail();
                                    this.buttonClicks[n] = 0;
                                }
                            }
                            if(data.correct==n) {
                                var s = 1+easeInOut((50-this.buttonClicks[n])/50)/5;
                                ctx.scale(s,s);
                            } else {
                                ctx.rotate((t%2*2-1)/(10+(50-this.buttonClicks[n])));
                            }
                        }
                        this.drawButton(button);
                        ctx.restore();

                        if(click&&Mouse.clickInBox(350+Math.floor(n/3)*300-130,500+n%3*170-60,260,120)) {
                            if(data.correct==n) {
                                data.correctScript();
                            } else {
                                data.failScript();
                            }
                            if(!this.buttonClicks[n]) this.buttonClicks[n] = 50;
                        }
                    }
                },
                drawButton: function(button) {
                    ctx.fillStyle = button.color;
                    ctx.roundRect(-130,-60,260,120,40);
                    ctx.fill();
                    ctx.strokeStyle = "black";
                    ctx.lineWidth = 5;
                    ctx.stroke();

                    ctx.fillStyle = button.textColor;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    f(50);
                    ctx.fillText(button.text,0,0);
                },
                reset: function() {
                    this.countDown = 400;
                    this.score = 0;
                    this.gameOver = false;
                    this.gameOverAnimation = 0;
                    this.newRound();
                },
                newRound: function() {
                    this.correct = false;
                    this.buttonClicks = [0,0,0,0,0,0];

                    this.maxTime = Math.round(Math.max(1000-Math.log(this.score)/Math.log(1.04)*5,100));
                    this.time = this.maxTime;

                    var colors = ["Red","Orange","Yellow","Green","Blue","Cyan","Purple","Pink","Black"];
                    var i1 = Math.floor(Math.random()*colors.length);
                    var i2 = Math.floor(Math.random()*colors.length);
                    var text = colors[i1];
                    var color = colors[i2].toLowerCase();
                    this.data = {};
                    this.data.promptButton = {text:text,color:color};
                    this.data.buttons = [];
                    var correctButton = {};
                    if(Math.random()<0.5) {
                        this.data.title = "Click the color of this button:";
                        correctButton.text = colors[i2];
                        correctButton.color = colors[Math.floor(Math.random()*colors.length)].toLowerCase();
                        colors.splice(i2,1);
                    } else {
                        this.data.title = "Click the button colored";
                        correctButton.color = colors[i1].toLowerCase();
                        correctButton.text = colors[Math.floor(Math.random()*colors.length)];
                        colors.splice(i1,2);
                    }
                    for(var n=0;n<5;n++) {
                        var button = {};
                        button.color = colors[Math.floor(Math.random()*colors.length)].toLowerCase();
                        button.text = colors[Math.floor(Math.random()*colors.length)];
                        this.data.buttons.push(button);
                    }
                    var i = Math.floor(Math.random()*5);
                    this.data.correct = i;
                    this.data.buttons.splice(i,0,correctButton);
                    this.data.correctScript = function() {game.correct = true;};
                    this.data.failScript = function() {game.gameOver = true;updateHighscore();};
                    this.data.endCorrect = function() {game.newRound();game.score++;};
                    this.data.endFail = function() {};
                },
                data: {},
                gameOver: false,
                gameOverAnimation: 0,
                buttonClicks: [0,0,0,0,0,0],
                page: "menu",
                countDown: 0,
                correct: false,
                score: 0,
                maxTime: 0,
                time: 0
            }
            
            function updateHighscore() {
                highscore = Math.max(highscore,game.score);
                localStorage.setItem("colorblindhighscore",highscore);
            }

            var t = 0;
            var highscore = 0;
            var tutorial = true;
            if(localStorage.getItem("colorblindhighscore")!=null) {
                highscore = localStorage.getItem("colorblindhighscore");
            }
        </script>
    </body>
</html>